N = 8
while {
	await Ac.probe()==0 & Bc.probe()==0 {
		s = (Ad.probe() + Bd.probe() + ci) % pow(2, N) and co = (Ad.probe() + Bd.probe() + ci) / pow(2, N)
		Sc.send(0) and Sd.send(s); ci=co
		Ac.recv() and Ad.recv() and Bc.recv() and Bd.recv()
	} or await Ac.probe()==0 & Bc.probe()==1 {
		s = (Ad.probe() + Bd.probe() + ci) % pow(2, N) and co = (Ad.probe() + Bd.probe() + ci) / pow(2, N)
		Sc.send(0) and Sd.send(s); ci=co
		Ac.recv() and Ad.recv()
	} or await Ac.probe()==1 & Bc.probe()==0 {
		s = (Ad.probe() + Bd.probe() + ci) % pow(2, N) and co = (Ad.probe() + Bd.probe() + ci) / pow(2, N)
		Sc.send(0) and Sd.send(s); ci=co
		Bc.recv() and Bd.recv()
	} or await Ac.probe()==1 & Bc.probe()==1 & co~=ci {
		s = (Ad.probe() + Bd.probe() + ci) % pow(2, N) and co = (Ad.probe() + Bd.probe() + ci) / pow(2, N)
		Sc.send(0) and Sd.send(s); ci=co
	} or await Ac.probe()==1 & Bc.probe()==1 & co==ci {
		s = (Ad.probe() + Bd.probe() + ci) % pow(2, N) and co = (Ad.probe() + Bd.probe() + ci) / pow(2, N)
		Sc.send(1) and Sd.send(s); ci=0
		Ac.recv() and Ad.recv() and Bc.recv() and Bd.recv()
	}
}
